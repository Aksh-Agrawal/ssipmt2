# <!-- Powered by BMADâ„¢ Core -->
# Story 3.3: External Traffic API Integration

## Status
Draft

## Story
**As a** developer,
**I want** the `agent-service` to connect to a real-time traffic API,
**so that** the agent can answer questions about traffic.

## Acceptance Criteria
1. The `agent-service` can successfully make an authenticated request to an external traffic API (e.g., Google Maps Routes API).
2. The service can parse the API response to extract meaningful traffic data (e.g., travel time, traffic conditions).
3. The external API key is securely managed as an environment variable and is not exposed client-side.

## Tasks / Subtasks
- [ ] Obtain an API key for the Google Maps Routes API. (AC: #1)
- [ ] Add the `GOOGLE_MAPS_API_KEY` to the `.env` configuration file for the backend. (AC: #3)
- [ ] In the `packages/services/agent` directory, create a new `trafficService.ts` file.
- [ ] In `trafficService.ts`, create a function (e.g., `getTrafficData`) that uses a fetch client to call the external traffic API. (AC: #1)
- [ ] Implement the logic within this function to parse the JSON response and extract key information. (AC: #2)
- [ ] Add robust error handling to manage potential API failures, such as network errors or invalid responses. (AC: #1, #2)

## Dev Notes
This story integrates a critical external dependency. The focus is on abstracting the third-party API call into a clean, reusable internal service.

- **External API:** The architecture specifies the Google Maps Routes API (`docs/architecture/7-external-apis.md`). The developer must consult its documentation to correctly format the request and handle the response.
- **API Key Management:** The API key must only be accessed on the backend via `process.env` and must never be exposed in any client-side code.
- **Service Abstraction:** Creating a dedicated `trafficService.ts` is crucial. It isolates the external dependency, making the main agent logic easier to test and maintain. The service should return a simplified, consistent data structure, not the raw API response.
- **Cost & Rate Limits:** The Google Maps API has usage costs and rate limits. While not part of the implementation, the developer should be mindful of this. Caching strategies will be important in the future.

### Testing
- **Integration Test:** Write an integration test for the `getTrafficData` function. Use a library like `nock` to intercept the outgoing HTTP request to the Google Maps API and provide a mock JSON response. Assert that the function correctly parses the mock data and returns the expected simplified object. Test error paths by mocking non-200 status codes from the API.

## Change Log
| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-10-18 | 1.0 | Initial draft of the story. | Sarah (PO) |
