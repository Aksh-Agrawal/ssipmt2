# <!-- Powered by BMADâ„¢ Core -->
# Story 2.3: Prioritized Report List View

## Status
Draft

## Story
**As an** admin,
**I want** to see a list of incoming reports, automatically sorted by urgency,
**so that** I can address the most critical issues first.

## Acceptance Criteria
1. A protected API endpoint is created to fetch all reports from the **Complaints DB**.
2. The API returns reports sorted first by priority (`High` > `Medium` > `Low`) and then by creation date (newest first).
3. The admin dashboard fetches data from this endpoint upon loading.
4. The dashboard displays the reports as a list, showing a summary of each (e.g., description snippet, priority, date).

## Tasks / Subtasks

### Backend
- [ ] Create a new protected API endpoint: `GET /api/v1/admin/reports`. (AC: #1)
- [ ] Apply the authentication middleware from Story 2.1 to this endpoint to ensure only logged-in users can access it. (AC: #1)
- [ ] Implement the repository function (`reportRepository.findAll`) to query the `reports` table. (AC: #2)
- [ ] The SQL query must include an `ORDER BY` clause that sorts by priority and then `created_at DESC`. (AC: #2)

### Frontend
- [ ] On the main dashboard page (`/dashboard`), implement a data fetching hook (e.g., using `React Query` or `SWR`) to call the `GET /api/v1/admin/reports` endpoint. (AC: #3)
- [ ] Create a `ReportList.tsx` component that receives an array of reports and maps over them. (AC: #4)
- [ ] Create a `ReportListItem.tsx` component to render the details for a single report, including a visual indicator for its priority (e.g., a colored badge). (AC: #4)
- [ ] Display a loading state while the data is being fetched. (AC: #3)
- [ ] Display an error state if the API call fails. (AC: #3)

## Dev Notes
This story provides the primary view for the admin user. The correctness of the sorting logic is the most critical part of the backend implementation.

- **API Security:** This endpoint must be robustly protected. Unauthenticated or unauthorized requests must be rejected with a `401` or `403` status.
- **Database Sorting:** To sort by the `priority` enum in the correct order, a `CASE` statement in the `ORDER BY` clause of the SQL query is the standard and recommended approach. For example: `ORDER BY CASE priority WHEN 'High' THEN 1 WHEN 'Medium' THEN 2 WHEN 'Low' THEN 3 ELSE 4 END, created_at DESC`.
- **Frontend Data Fetching:** The architecture recommends using a client-side data-caching library like `React Query` (TanStack Query) to handle fetching, caching, loading, and error states. This is the ideal place to introduce it.
- **UI/UX:** The list items should be easily scannable. The priority badge should be color-coded for quick identification (e.g., Red for High, Orange for Medium, Green for Low).

### Testing
- **Backend Integration Test:** Write a test for the `GET /api/v1/admin/reports` endpoint. Seed the test database with multiple reports having different priorities and dates. Assert that the API response body contains the reports in the correct, sorted order.
- **Frontend Component Tests:** Write unit tests for `ReportList` and `ReportListItem` by passing mock report data and verifying the correct information and styles are rendered.
- **Frontend Integration Test:** Write a test for the main dashboard page. Mock the API endpoint and verify that the page correctly displays the loading state, and then renders the list of reports once the mock API resolves.

## Change Log
| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-10-18 | 1.0 | Initial draft of the story. | Sarah (PO) |
