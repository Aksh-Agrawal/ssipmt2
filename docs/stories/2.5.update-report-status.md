# <!-- Powered by BMADâ„¢ Core -->
# Story 2.5: Update Report Status

## Status
Draft

## Story
**As an** admin,
**I want** to change a report's status (e.g., "In Progress," "Resolved") from the detail view,
**so that** I can track its lifecycle.

## Acceptance Criteria
1. The report detail view contains UI controls (e.g., a dropdown menu) to change the report's status.
2. A protected API endpoint is created to handle updating the report's status in the **Complaints DB**.
3. When an admin changes the status, the new status is sent to the API endpoint.
4. The UI on the detail page updates to reflect the new status without requiring a full page reload.

## Tasks / Subtasks

### Backend
- [ ] Create a new dynamic, protected API endpoint: `PATCH /api/v1/admin/reports/[id]`. (AC: #2)
- [ ] The endpoint should accept a JSON body with the new status, e.g., `{ "status": "InProgress" }`. (AC: #3)
- [ ] Implement input validation to ensure the provided status is a valid value from the `ReportStatus` enum. (AC: #3)
- [ ] Implement the repository function (`reportRepository.update`) to change the `status` of the specified report in the database. (AC: #2)

### Frontend
- [ ] On the report detail page, add a dropdown menu or similar UI control populated with the values from the `ReportStatus` enum. (AC: #1)
- [ ] Create a function in the admin data service to call the `PATCH /api/v1/admin/reports/[id]` endpoint. (AC: #3)
- [ ] When the admin selects a new status, call this service function.
- [ ] On a successful API response, update the local client state to reflect the change, ensuring the UI updates instantly. (AC: #4)

## Dev Notes
This story introduces the first data mutation from the admin dashboard. A smooth and responsive user experience is key.

- **API Design:** Using the `PATCH` HTTP method is the correct semantic choice for this partial update.
- **Frontend State Management:** This is a perfect use case for the mutation and cache-updating features of a library like `React Query` or `SWR`. The goal is to update the UI optimistically or upon success, providing a fast user experience without a manual refresh.
- **UI Controls:** A dropdown menu is a simple and effective way to present the status choices. It should be pre-populated with the current status of the report.
- **Data Model:** The `ReportStatus` enum should be imported from the `packages/shared-types` package to ensure consistency between the frontend and backend.

### Testing
- **Backend Integration Test:** Write a test for the `PATCH` endpoint. First, create a report. Then, call the endpoint with a new status. Finally, fetch the report again to assert that the status was correctly updated in the database.
- **Frontend Integration Test:** On the report detail page test, mock the `PATCH` API endpoint. Simulate the admin selecting a new status from the dropdown. Verify that the correct API call is made. On mock API success, verify that the UI updates to display the new status.

## Change Log
| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-10-18 | 1.0 | Initial draft of the story. | Sarah (PO) |
