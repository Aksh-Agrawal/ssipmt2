# <!-- Powered by BMADâ„¢ Core -->
# Story 4.2: Create & Edit Informational Content

## Status
Draft

## Story
**As an** admin,
**I want** a form to create and edit informational content with a title, body, and relevant tags,
**so that** I can add new knowledge for the agent.

## Acceptance Criteria
1. The admin dashboard has a form for creating and editing `KnowledgeArticle`s.
2. The form includes fields for `title`, `content` (body), and `tags`.
3. Submitting the form for a new article saves it as a new document in the **Live DB**.
4. Submitting the form for an existing article updates the corresponding document in the **Live DB**.

## Tasks / Subtasks

### Backend
- [ ] Create a `POST /api/v1/admin/knowledge` endpoint to create a new article. (AC: #3)
- [ ] Create a `PATCH /api/v1/admin/knowledge/[id]` endpoint to update an existing article. (AC: #4)
- [ ] Both endpoints must be protected by the authentication middleware. (AC: #3, #4)
- [ ] Implement the repository logic to save/update the `KnowledgeArticle` in Redis. This must include updating the main article hash/JSON as well as adding/removing article IDs from the tag-based Redis Sets. (AC: #3, #4)

### Frontend
- [ ] Create a new page/form component for creating and editing an article. (AC: #1)
- [ ] The "Create New Article" button from the previous story should link to this form. (AC: #1)
- [ ] The form should have inputs for `title`, `content`, and `tags`. (AC: #2)
- [ ] Implement client-side service functions to call the `POST` and `PATCH` endpoints. (AC: #3, #4)
- [ ] On form submission, call the appropriate service function. On success, navigate the user back to the agent content list.

## Dev Notes
This story implements the core content management functionality. The interaction with Redis is more complex than a simple key-value store, as it involves managing indexes (sets) as well.

- **Redis Logic:** When creating or updating an article, the repository logic must handle both the article data itself (`kb:article:<id>`) and the tag indexes (`kb:tag:<tag>`). For updates, this may involve removing the article ID from sets for tags that were removed and adding it to sets for new tags.
- **UI/UX:** For the `tags` field, a specialized tag input component (which shows tags as chips) would provide a much better user experience than a plain text input.
- **Reusable Form:** Use a single form component for both creating and editing. The component can fetch the article data if an `id` is present in the URL and operate in "edit mode".

### Testing
- **Backend Integration Tests:** Write tests for the `POST` and `PATCH` endpoints. For `POST`, assert that the article is created in Redis and that the tag sets are correctly populated. For `PATCH`, assert that an existing article is updated and that tag sets are correctly modified (both additions and removals).
- **Frontend Integration Test:** Test the form component. In "edit mode", mock the initial data fetch and assert the form is populated correctly. Test form submission in both modes, verifying that the correct API endpoint is called with the correct payload.

## Change Log
| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-10-18 | 1.0 | Initial draft of the story. | Sarah (PO) |
